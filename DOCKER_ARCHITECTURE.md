# ğŸ—ï¸ Docker Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DOCKER HOST MACHINE                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Docker Compose Network (carrent-network)         â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚  â”‚   App Container  â”‚      â”‚  MySQL Container â”‚             â”‚ â”‚
â”‚  â”‚  â”‚   (carrent-app)  â”‚      â”‚   (carrent-db)   â”‚             â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚      â”‚                  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Nginx    â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚   MySQL    â”‚ â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   (Port 80)â”‚  â”‚      â”‚  â”‚  (Port     â”‚ â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â”‚   3306)    â”‚ â”‚             â”‚ â”‚
â”‚  â”‚  â”‚        â”‚         â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚         â”‚       â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  PHP-FPM   â”‚  â”‚      â”‚         â”‚       â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (Port     â”‚  â”‚      â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   9000)    â”‚  â”‚      â”‚    â”‚ Persist â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚    â”‚ Volume  â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚        â”‚         â”‚      â”‚    â”‚mysql-   â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚    â”‚ data    â”‚  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Supervisor â”‚  â”‚      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚  â”‚        â”‚         â”‚               â–²                       â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚                       â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Laravel  â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    App     â”‚  â”‚               â”‚                       â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚                       â”‚ â”‚
â”‚  â”‚  â”‚        â”‚         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚  â”‚        â”‚         â”‚      â”‚  Redis Container â”‚             â”‚ â”‚
â”‚  â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–ºâ”‚  (carrent-redis) â”‚             â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚      â”‚                  â”‚             â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚  â”‚   Redis    â”‚ â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚  â”‚  (Port     â”‚ â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚  â”‚   6379)    â”‚ â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚         â”‚       â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚    â”‚ Persist â”‚  â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚    â”‚ Volume  â”‚  â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚    â”‚redis-   â”‚  â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚    â”‚ data    â”‚  â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚ â”‚
â”‚  â”‚          â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚          â”‚                                                  â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                           â”‚ â”‚
â”‚  â”‚    â”‚  Volume   â”‚                                           â”‚ â”‚
â”‚  â”‚    â”‚ ./storage â”‚                                           â”‚ â”‚
â”‚  â”‚    â”‚  (Logs &  â”‚                                           â”‚ â”‚
â”‚  â”‚    â”‚  Uploads) â”‚                                           â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  Port Mappings:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Host:8080    â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ App:80      â”‚                      â”‚
â”‚  â”‚ Host:3307    â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ MySQL:3306  â”‚                      â”‚
â”‚  â”‚ Host:6380    â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Redis:6379  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Browser     â”‚
    â”‚ localhost:8080â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request Flow

```
1. Browser Request
   â”‚
   â””â”€â–º http://localhost:8080/cars
           â”‚
           â–¼
2. Docker Port Mapping (8080 â†’ 80)
           â”‚
           â–¼
3. Nginx (App Container)
   â”‚
   â”œâ”€â–º Static files (CSS/JS) â†’ Serve directly
   â”‚
   â””â”€â–º PHP files â†’ Forward to PHP-FPM (port 9000)
                          â”‚
                          â–¼
4. PHP-FPM processes Laravel
   â”‚
   â”œâ”€â–º Query Database (MySQL:3306)
   â”‚         â”‚
   â”‚         â””â”€â–º mysql-data volume (persistent)
   â”‚
   â”œâ”€â–º Cache/Session (Redis:6379)
   â”‚         â”‚
   â”‚         â””â”€â–º redis-data volume (persistent)
   â”‚
   â””â”€â–º File operations (./storage)
             â”‚
             â””â”€â–º ./storage volume (persistent)
                          â”‚
                          â–¼
5. Response sent back through Nginx
           â”‚
           â–¼
6. Browser receives HTML/JSON
```

## Build Process Flow

```
Docker Build Command
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 1: Node Builder (Alpine)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Copy package.json           â”‚  â”‚
â”‚  â”‚ 2. npm ci (install deps)       â”‚  â”‚
â”‚  â”‚ 3. Copy source files           â”‚  â”‚
â”‚  â”‚ 4. npm run build (Vite+Tailwind)â”‚ â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ OUTPUT: public/build/          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ app.css (minified)        â”‚  â”‚
â”‚  â”‚  â””â”€â”€ app.js (minified)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 2: Composer Builder           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Copy composer.json          â”‚  â”‚
â”‚  â”‚ 2. composer install            â”‚  â”‚
â”‚  â”‚    --no-dev                    â”‚  â”‚
â”‚  â”‚    --optimize-autoloader       â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ OUTPUT: vendor/                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ autoload.php              â”‚  â”‚
â”‚  â”‚  â””â”€â”€ [optimized dependencies]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stage 3: Production Image (Alpine)  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Install PHP 8.2 + Extensionsâ”‚  â”‚
â”‚  â”‚    â€¢ pdo_mysql                 â”‚  â”‚
â”‚  â”‚    â€¢ redis                     â”‚  â”‚
â”‚  â”‚    â€¢ gd, zip, bcmath, etc.     â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 2. Install Nginx               â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 3. Install Supervisor          â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 4. Copy from Stage 1:          â”‚  â”‚
â”‚  â”‚    public/build/ â†’ Final image â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 5. Copy from Stage 2:          â”‚  â”‚
â”‚  â”‚    vendor/ â†’ Final image       â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 6. Copy application code       â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 7. Copy config files           â”‚  â”‚
â”‚  â”‚    â€¢ php.ini, php-fpm.conf     â”‚  â”‚
â”‚  â”‚    â€¢ nginx.conf, default.conf  â”‚  â”‚
â”‚  â”‚    â€¢ supervisord.conf          â”‚  â”‚
â”‚  â”‚    â€¢ entrypoint.sh             â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 8. Set permissions             â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ FINAL IMAGE SIZE: ~150-200MB   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   Docker Image
  (ready to run)
```

## Container Startup Sequence

```
docker-compose up
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Create Network: carrent-network  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Start MySQL Container            â”‚
â”‚    â”œâ”€â–º Mount mysql-data volume      â”‚
â”‚    â”œâ”€â–º Set environment variables    â”‚
â”‚    â””â”€â–º Health check: mysqladmin pingâ”‚
â”‚                                     â”‚
â”‚    Status: Healthy âœ“                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Start Redis Container            â”‚
â”‚    â”œâ”€â–º Mount redis-data volume      â”‚
â”‚    â””â”€â–º Health check: redis-cli ping â”‚
â”‚                                     â”‚
â”‚    Status: Healthy âœ“                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Start App Container              â”‚
â”‚    (Waits for DB & Redis healthy)   â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ entrypoint.sh runs:         â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚ 1. Wait for DB connection   â”‚  â”‚
â”‚    â”‚    â””â”€â–º php artisan db:show  â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚ 2. Cache configuration      â”‚  â”‚
â”‚    â”‚    â”œâ”€â–º config:cache         â”‚  â”‚
â”‚    â”‚    â”œâ”€â–º route:cache          â”‚  â”‚
â”‚    â”‚    â””â”€â–º view:cache           â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚ 3. Run migrations           â”‚  â”‚
â”‚    â”‚    â””â”€â–º migrate --force      â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚ 4. Create storage link      â”‚  â”‚
â”‚    â”‚    â””â”€â–º storage:link         â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚ 5. Set permissions          â”‚  â”‚
â”‚    â”‚    â””â”€â–º chown, chmod         â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚ 6. Start Supervisor         â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                      â”‚
â”‚              â–¼                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ Supervisor starts:          â”‚  â”‚
â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚    â”‚ â”‚ PHP-FPM â”‚  â”‚   Nginx   â”‚ â”‚  â”‚
â”‚    â”‚ â”‚ :9000   â”‚  â”‚   :80     â”‚ â”‚  â”‚
â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚    Health check: curl /health       â”‚
â”‚    Status: Healthy âœ“                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Application Ready                â”‚
â”‚    http://localhost:8080            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Persistence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Volumes (Persistent)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚  mysql-data (Docker managed volume)           â”‚
â”‚  â”œâ”€â–º /var/lib/mysql (in container)           â”‚
â”‚  â””â”€â–º Survives: container restart/rebuild     â”‚
â”‚      Lost on: docker-compose down -v         â”‚
â”‚                                               â”‚
â”‚  redis-data (Docker managed volume)           â”‚
â”‚  â”œâ”€â–º /data (in container)                    â”‚
â”‚  â””â”€â–º Survives: container restart/rebuild     â”‚
â”‚      Lost on: docker-compose down -v         â”‚
â”‚                                               â”‚
â”‚  ./storage (Bind mount to host)               â”‚
â”‚  â”œâ”€â–º /var/www/html/storage (in container)    â”‚
â”‚  â”œâ”€â–º ./storage (on host machine)             â”‚
â”‚  â””â”€â–º Survives: everything (on host disk)     â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Network Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Internal Docker Network               â”‚
â”‚        (carrent-network: bridge)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  App Container                               â”‚
â”‚  â”œâ”€â–º Hostname: app                          â”‚
â”‚  â”œâ”€â–º IP: 172.x.x.2 (auto-assigned)          â”‚
â”‚  â””â”€â–º Can access:                            â”‚
â”‚       â€¢ db:3306 (MySQL)                     â”‚
â”‚       â€¢ redis:6379 (Redis)                  â”‚
â”‚                                              â”‚
â”‚  MySQL Container                             â”‚
â”‚  â”œâ”€â–º Hostname: db                           â”‚
â”‚  â”œâ”€â–º IP: 172.x.x.3 (auto-assigned)          â”‚
â”‚  â””â”€â–º Accessible by: app                     â”‚
â”‚                                              â”‚
â”‚  Redis Container                             â”‚
â”‚  â”œâ”€â–º Hostname: redis                        â”‚
â”‚  â”œâ”€â–º IP: 172.x.x.4 (auto-assigned)          â”‚
â”‚  â””â”€â–º Accessible by: app                     â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Exposed Ports (Host access)
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host Machine (Windows)                      â”‚
â”‚  â”œâ”€â–º localhost:8080  â†’ app:80               â”‚
â”‚  â”œâ”€â–º localhost:3307  â†’ db:3306              â”‚
â”‚  â””â”€â–º localhost:6380  â†’ redis:6379           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Production Deployment (Vercel)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GitHub Repository             â”‚
â”‚  (Push code)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Vercel Build Process              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. composer install --no-dev         â”‚  â”‚
â”‚  â”‚ 2. npm run build                     â”‚  â”‚
â”‚  â”‚ 3. Deploy to serverless functions    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Vercel Serverless Platform          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Serverless PHP Functions            â”‚  â”‚
â”‚  â”‚  â”œâ”€â–º public/index.php                â”‚  â”‚
â”‚  â”‚  â””â”€â–º Auto-scaling                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚  External Services (Required):             â”‚
â”‚  â”œâ”€â–º Database: PlanetScale/AWS RDS        â”‚
â”‚  â”œâ”€â–º Storage: AWS S3 / DO Spaces          â”‚
â”‚  â”œâ”€â–º Cache: Vercel KV / Upstash Redis     â”‚
â”‚  â””â”€â–º Email: SendGrid / Mailgun            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        your-app.vercel.app                 â”‚
â”‚        (Live Production Site)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure in Container

```
/var/www/html/ (Container)
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Models/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ bootstrap/
â”‚   â””â”€â”€ cache/          â† Writable (Laravel cache)
â”œâ”€â”€ config/
â”œâ”€â”€ database/
â”œâ”€â”€ docker/             â† Configuration files
â”‚   â”œâ”€â”€ php/
â”‚   â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ supervisor/
â”‚   â””â”€â”€ entrypoint.sh
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ build/          â† Built assets (from Stage 1)
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ index.php
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ css/
â”‚   â””â”€â”€ js/
â”œâ”€â”€ routes/
â”œâ”€â”€ storage/            â† Writable (mounted volume)
â”‚   â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ framework/
â”‚   â””â”€â”€ logs/
â”œâ”€â”€ vendor/             â† PHP dependencies (from Stage 2)
â”œâ”€â”€ .env                â† Environment config (mounted)
â”œâ”€â”€ artisan
â””â”€â”€ composer.json
```

## Health Check Flow

```
Docker Health Check (every 30s)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ curl -f http://localhost/health     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                â”‚
      â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Success â”‚      â”‚  Fail   â”‚
â”‚ (200 OK)â”‚      â”‚ (404/5xx)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â–¼                â–¼
Container        Retry 3x
Healthy          â”€â”€â”€â”€â”
                     â”‚
                     â–¼
              Mark Unhealthy
                     â”‚
                     â–¼
              Docker Restarts
                Container
```

---

## Legend

```
â”Œâ”€â”€â”€â”€â”€â”
â”‚ Box â”‚  = Container or Component
â””â”€â”€â”€â”€â”€â”˜

  â”‚
  â–¼     = Flow or Connection
  
  â—„â”€â”€â–º  = Bidirectional Communication

 :9000  = Port Number

 âœ“      = Healthy/Ready State
```

---

This architecture ensures:
- âœ… **Isolation**: Each service in its own container
- âœ… **Scalability**: Can scale containers independently
- âœ… **Persistence**: Data survives restarts
- âœ… **Security**: Internal network, minimal exposed ports
- âœ… **Performance**: Optimized build process, caching enabled
- âœ… **Reliability**: Health checks, automatic restarts
